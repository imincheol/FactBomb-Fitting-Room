# 2. 분석 모드 및 로직 (Analysis Modes & Logic)

이 문서는 사용 가능한 세 가지 분석 모드(노말, 믹스, 풀)의 상세 로직과 데이터 흐름을 비교 설명합니다.

## 1. 공통 데이터 추출 흐름 (Common Data Extraction)
**적용 모드**: `노말 모드(Normal/Legacy)`, `믹스 모드(Mix)`

노말 모드와 믹스 모드는 기본적으로 동일한 **이미지 분석 파이프라인**을 공유합니다. AI가 개입하기 전, 컴퓨터 비전(CV) 기술을 통해 이미지로부터 객관적인 수치 데이터를 추출하는 과정입니다.

1.  **이미지 수신 및 전처리**:
    *   사용자와 모델의 이미지를 `numpy` 배열로 변환합니다.
2.  **랜드마크 감지 (Landmark Detection)**:
    *   라이브러리: `MediaPipe Pose`
    *   **추출 데이터**:
        *   코(Nose): 머리 위치 및 높이 기준점.
        *   어깨(Shoulders): 상반신 시작점.
        *   엉덩이(Hips): 상/하반신 분기점.
        *   발목(Ankles): 키의 끝점.
3.  **데이터 계산 (Metric Calculation)**:
    *   **헤드 크기 측정**: 코와 어깨 사이의 거리를 기반으로 머리 크기(픽셀)를 추정.
    *   **신체 비율(N등신) 계산**: (발목 y좌표 - 정수리 y좌표) / 머리 크기.
    *   **비율 추출**: 다리 길이, 상체 길이 등의 수치적 비율 산출.

---

## 2. 모드별 상세 로직 비교

### A. 노말 모드 (Normal / Legacy Mode)
**"AI 없는 순수 알고리즘 모드 (No-AI)"**

```mermaid
flowchart LR
    Img[이미지 입력] --> CV[CV/MediaPipe\n랜드마크 추출]
    CV --> Data[수치 데이터\n(N등신/비율)]
    Data --> Logic{단순 규칙\nIf/Else}
    Logic -->|차이 큼| Res1[비판 멘트 선택]
    Logic -->|차이 작음| Res2[칭찬 멘트 선택]
    Res1 & Res2 --> Final[결과 반환]
```

추출된 데이터를 정해진 규칙(Rule-based)에 따라 처리합니다.
*   **입력**: 위에서 추출된 `N등신 수치`, `신체 비율`.
*   **로직 활용**:
    *   **비교 연산**: (사용자 N등신 - 모델 N등신)의 차이를 계산.
    *   **조건문(If/Else)**: 차이가 1.0 이상이면 "심각", 0.5 이상이면 "주의", 비슷하면 "완벽" 등으로 분류.
*   **결과 생성**: 사전에 작성된 정적(Static) 텍스트 리스트에서 조건에 맞는 문구를 랜덤 선택.
    *   *예: "모델보다 머리가 1.5배 커보이네요..."*
*   **특징**: 항상 예측 가능한 결과를 반환하며, 외부 API 호출이 없어 가장 빠름.

### B. 믹스 모드 (Mix Mode)
**"데이터 기반 AI 텍스트 생성 모드"**

```mermaid
flowchart LR
    Img[이미지 입력] --> CV[CV/MediaPipe\n랜드마크 추출]
    CV --> Data[수치 데이터\n(N등신/비율)]
    Data --> Prompt[텍스트 프롬프트 변환]
    Prompt --> AI[Gemini Text API]
    AI --> Res[창의적 팩폭 멘트 생성]
    Res --> Final[결과 반환]
```

데이터 추출 단계는 노말 모드와 100% 동일하지만, 결과를 해석하고 표현하는 단계에서 AI를 활용합니다.
*   **입력**: 위에서 추출된 `N등신 수치(float)`, `신체 비율(dict)`. **(이미지 아님)**
*   **로직 활용**:
    *   추출된 수치 데이터를 텍스트 프롬프트로 변환합니다.
    *   *프롬프트 예: "사용자는 6.5등신, 모델은 8.0등신이다. 이 차이에 대해 유머러스하게 지적해줘."*
*   **AI 처리 (Gemini Text)**:
    *   수치적 팩트를 바탕으로 창의적이고 다양한 표현의 "팩트폭행" 멘트를 작성.
*   **특징**: 측정값은 정확(알고리즘)하고, 멘트는 다양(AI). 이미지 처리는 로컬에서 하므로 Vision 비용 절감.

### C. 풀 모드 (Full AI Mode)
**"완전 AI 비전 모드"**

```mermaid
flowchart LR
    Img[이미지 입력] --> Bypass[로컬 CV 생략/단순참고]
    Img --> AI[Gemini Vision API]
    AI --> Vision[시각적 분석\n(패션/자세/비율)]
    Vision --> Res[종합 코멘트 & 수치 추정]
    Res --> Final[결과 반환]
```

앞선 두 모드와 달리, **공통 데이터 추출 흐름을 타지 않는(Bypass)** 독자적인 흐름을 가질 수 있습니다.
*   **입력**: `원본 이미지(Raw Image Data)` 그 자체.
*   **로직 활용**:
    *   로컬에서 랜드마크를 계산하거나 N등신을 재는 과정을 생략(또는 참고용으로만 사용)합니다.
    *   이미지 바이너리를 직접 Gemini Vision API로 전송합니다.
*   **AI 처리 (Gemini Vision)**:
    *   **시각적 분석**: AI가 이미지 내의 패션, 자세, 배경, 분위기까지 전체적으로 "바라봅니다(See)".
    *   **추정 및 생성**: AI가 자체적인 판단으로 "약 7.5등신 정도로 보임"이라고 추정하고, 그 시각적 맥락(예: "옷이 너무 헐렁해서 키가 작아 보여요")까지 포함하여 코멘트를 작성합니다.
*   **특징**: 기하학적 수치보다는 전체적인 "느낌(Vibe)"과 스타일 분석에 강점. 정확한 수치보다는 맥락적인 조언 가능.

